import dependencies.Dep
import dependencies.Packages
import dependencies.Versions

plugins {
    id 'com.android.application'
    id 'kotlin-android'
    id 'kotlin-parcelize'
    id 'kotlin-kapt'
}

android {
    compileSdkVersion Versions.compileSdk

    defaultConfig {
        applicationId Packages.production
        minSdkVersion Versions.minSdk
        targetSdkVersion Versions.targetSdk
        versionCode Versions.versionCode
        versionName Versions.versionName
        testApplicationId Packages.test
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        resConfigs "ja"
    }

    buildFeatures {
        dataBinding true
        viewBinding true
    }

    buildTypes {
        debug {
            minifyEnabled false
            applicationIdSuffix = '.debug'
        }
        release {
            minifyEnabled true
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }

    flavorDimensions "default"
    productFlavors {
        prod {
            dimension "default"
        }
        demo {
            dimension "default"
        }
    }

    lintOptions {
        abortOnError false
    }

    testOptions {
        animationsDisabled = true
        resultsDir = "$project.buildDir/test-results"
        unitTests.all {
            jvmArgs '-XX:MaxMetaspaceSize=256m'
            systemProperty 'debug', 'true'

            jacoco {
                includeNoLocationClasses true
            }
        }
        unitTests {
            includeAndroidResources true
            returnDefaultValues = true
        }
    }

    sourceSets {
        all {
            java.srcDirs += "src/${name}/kotlin"
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = '11'
    }
}

dependencies {
    implementation Dep.Kotlin.coroutinesAndroid

    implementation 'com.jakewharton.retrofit:retrofit2-kotlin-coroutines-adapter:0.9.2'

    implementation Dep.Koin.core
    implementation Dep.Koin.android

    implementation Dep.AndroidX.appCompat
    implementation Dep.AndroidX.preference
    implementation Dep.AndroidX.card
    implementation Dep.AndroidX.coreKtx
    implementation Dep.AndroidX.activityKtx
    implementation Dep.AndroidX.fragmentKtx
    implementation Dep.AndroidX.design
    implementation Dep.AndroidX.constraintLayout

    implementation Dep.Zxing.core
    implementation(Dep.Zxing.android) {
        transitive = false
    }

    implementation Dep.OkHttp.client
    implementation Dep.Retrofit.client
    implementation Dep.Retrofit.converterGson

    implementation Dep.logger
    implementation Dep.eventBus

    testImplementation Dep.Test.junit
    testImplementation Dep.Koin.test
    testImplementation Dep.Test.archCore
    testImplementation Dep.Test.testCoreKtx
    testImplementation Dep.Test.androidJunit4Ktx
    testImplementation Dep.Test.testRunner
    testImplementation Dep.Test.testRules
    testImplementation Dep.Test.coroutinesTest
    testImplementation Dep.Test.Mockito.core
    testImplementation Dep.Test.Mockito.kotlin
    testImplementation Dep.Test.Robolectric.client
    testImplementation Dep.OkHttp.mockWebServer

    androidTestImplementation Dep.Test.androidJunit4Ktx
    androidTestImplementation Dep.Test.testRunner
    androidTestImplementation Dep.OkHttp.mockWebServer
    androidTestImplementation Dep.Test.Mockito.android
}
